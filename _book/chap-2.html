
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Chap 2 - Cas pratique : DuckCoin, la cryptomonnaie sur mobile - Développement d'applications mobiles avec Ionic</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
          <meta name="author" content="Charles EDOU NZE">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="chap-3-installation-de-ionic-et-premieres-prises-en-main.html" />
    
    
    <link rel="prev" href="chapter1.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Couverture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="tables-matieres.html">
            
                <a href="tables-matieres.html">
            
                    
                    Tables matières
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="copyright.html">
            
                <a href="copyright.html">
            
                    
                    Copyright
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="a-propos-de-lauteur.html">
            
                <a href="a-propos-de-lauteur.html">
            
                    
                    A propos de l'auteur
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="chapter1.html">
            
                <a href="chapter1.html">
            
                    
                    Chap 1 - Une brêve histoire du mobile
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.7" data-path="chap-2.html">
            
                <a href="chap-2.html">
            
                    
                    Chap 2 - Cas pratique : DuckCoin, la cryptomonnaie sur mobile
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="chap-3-installation-de-ionic-et-premieres-prises-en-main.html">
            
                <a href="chap-3-installation-de-ionic-et-premieres-prises-en-main.html">
            
                    
                    Chap 3 - Installation de Ionic et première prise en main
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="chap-4-templates-et-customisation.html">
            
                <a href="chap-4-templates-et-customisation.html">
            
                    
                    Chap 4 - Templates et Customisation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="chap-5-utilisation-des-composants-ionic.html">
            
                <a href="chap-5-utilisation-des-composants-ionic.html">
            
                    
                    Chap 5 - Utilisation des composants Ionic
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="chap-6-introduction-au-langage-typescript-le-futur-de-javascript.html">
            
                <a href="chap-6-introduction-au-langage-typescript-le-futur-de-javascript.html">
            
                    
                    Chap 6 - Introduction au langage TypeScript, le futur de JavaScript
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="chap-7-introduction-au-framework-angular.html">
            
                <a href="chap-7-introduction-au-framework-angular.html">
            
                    
                    Chap 7 - Introduction au framework Angular
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="chap-8-architecture-avancee-dune-application-ionic-composants-directives-providers-et-modules.html">
            
                <a href="chap-8-architecture-avancee-dune-application-ionic-composants-directives-providers-et-modules.html">
            
                    
                    Chap 8 - Architecture avancée d'une application Ionic : Composants, Directives, Providers, Services, Pipes, Modules, persistance de données et plugins natifs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="chap-9-debogage-tests-et-monitoring.html">
            
                <a href="chap-9-debogage-tests-et-monitoring.html">
            
                    
                    Chap 9 - Tests et débogages avancés
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="chap-10-ionic-et-son-ecosysteme-cloud-lab-et-creator.html">
            
                <a href="chap-10-ionic-et-son-ecosysteme-cloud-lab-et-creator.html">
            
                    
                    Chap 10 - Ionic et son écosystème : Cloud, Lab, View et Creator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="chap-11-publication-sur-les-stores.html">
            
                <a href="chap-11-publication-sur-les-stores.html">
            
                    
                    Chap 11 - Publication sur les stores
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="chap-12-introduction-au-pwa-avec-stencil-et-capacitor.html">
            
                <a href="chap-12-introduction-au-pwa-avec-stencil-et-capacitor.html">
            
                    
                    Chap 12 - Introduction au PWA avec Stencil et Capacitor
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>
</ul>

                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Chap 2 - Cas pratique : DuckCoin, la cryptomonnaie sur mobile</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="chap-2---cas-pratique--duckcoin-la-cryptomonnaie-sur-mobile">Chap 2 - Cas pratique : DuckCoin, la cryptomonnaie sur mobile</h1>
<p>Explorer Ionic et son &#xE9;cosyst&#xE8;me peut vite devenir tr&#xE8;s long, alors pour faire &#xE0; peu pr&#xE8;s le tour du sujet, je vous propose dans ce livre de partir d&apos;un projet concret qui va nous permettre d&apos;aborder tous les concepts techniques dont vous aurez besoin pour lancer votre propre application mobile.</p>
<p>Apr&#xE8;s r&#xE9;flexion, et aimant surfer sur les tendances technologiques du moment, je vous propose d&apos;explorer l&apos;univers des cryptomonnaies en d&#xE9;veloppant notre propre monnaie num&#xE9;rique, bas&#xE9; sur une blockchain du m&#xEA;me et que nous appelerons <strong>DuckCoin, </strong>en hommage &#xE0; la mascotte du d&#xE9;partement MMI de l&apos;IUT de Troyes.</p>
<p>Un site internet a &#xE9;t&#xE9; cr&#xE9;&#xE9; pour l&apos;occasion. Vous pourrez le visiter, vous inscrire et tester notre cryptomonnaie solidaire : <a href="https://duckcoin.charlesen.fr" target="_blank">https://duckcoin.charlesen.fr</a><img src="assets/duckcoin.png" alt=""></p>
<p>C&#x2019;est &#xE0; la une de quasiment tous les journaux d&#x2019;information. Par une seule semaine sans que l&#x2019;on vous parle ci et l&#xE0; du Bitcoin, de Ripple ou d&#x2019;une autre crypto-monnaie en vogue.</p>
<p>Une crypto-monnaie est selon Wikip&#xE9;dia :</p>
<blockquote>
<p>Une monnaie virtuelle utilisable sur un r&#xE9;seau informatique d&#xE9;centralis&#xE9;, de pair &#xE0; pair</p>
</blockquote>
<p>Dit autrement, c&#x2019;est comme remplacer ses euros, ses dollars ou ses francs CFA par une devise stock&#xE9;e en ligne ou directement dans votre ordinateur ou cl&#xE9; usb. Bitcoin, la plus c&#xE9;l&#xE8;bre des crypto-monnaies et celle qui vaut le plus ch&#xE8;re, a &#xE9;t&#xE9; lanc&#xE9; quelques temps seulement apr&#xE8;s la crise financi&#xE8;re de 2008 : la fameuse crise des subprimes.</p>
<p>Quelques ann&#xE9;es plus tard, on d&#xE9;nombre plus de 1000 crypto-monnaies selon le site internet <a href="https://coinmarketcap.com/" target="_blank">CoinMarketCap</a> pour une capitalisation boursi&#xE8;re (valeur au prix du march&#xE9; de l&#x2019;ensemble des crypto-monnaies en circulation) de plus de 740 milliards de dollars. C&#x2019;est juste &#xE9;norme et ce n&#x2019;est rien compar&#xE9; au potentiel de ce nouveau march&#xE9;.</p>
<h2 id="principales-crypto-monnaies">Principales crypto-monnaies</h2>
<h3 id="bitcoin">Bitcoin</h3>
<p>Bitcoin est une devise virtuelle pair-&#xE0;-pair d&#xE9;centralis&#xE9;e qui fonctionne gr&#xE2;ce &#xE0; ses utilisateurs, sans autorit&#xE9; centrale ni interm&#xE9;diaire. Elle vaut &#xE0; l&#x2019;heure o&#xF9; j&#x2019;&#xE9;cris ces quelques lignes autour de 6 616,51 dollars, soit environ 5 405,71 euros, soit plus de 3,5 millions de Franc CFA. C&#x2019;est juste &#xE9;norme.</p>
<p><strong>1 Bitcoin = &#x20AC;5 405,71</strong></p>
<h3 id="ripple">Ripple</h3>
<p>Ripple est un syst&#xE8;me de r&#xE8;glement brut en temps r&#xE9;el, un march&#xE9; des changes et un r&#xE9;seau de transfert de fonds. &#xC9;galement appel&#xE9; le Ripple Transaction Protocol ou Protocole Ripple, il est construit sur un protocole Internet distribu&#xE9; et open source, un registre de consensus et une monnaie native appel&#xE9;e XRP. Lanc&#xE9; en 2012, le r&#xE9;seau Ripple a pour objectif de permettre des transactions financi&#xE8;res mondiales s&#xE9;curis&#xE9;es, instantan&#xE9;es et presque gratuites, de toute taille sans rejets de d&#xE9;bit.</p>
<p>Ripple et Bitcoin utilisent une m&#xE9;thode diff&#xE9;rente pour parvenir &#xE0; un consensus r&#xE9;seau. Ripple utilise un processus de consensus it&#xE9;ratif, tandis que Bitcoin utilise le &#xAB; Proof of Work &#xBB; (minage). Par cons&#xE9;quent, Ripple est plus rapide que Bitcoin. La finalisation des transactions ne prend que quelques secondes.</p>
<p><strong>1 Ripple = &#x20AC;0,382906</strong></p>
<h3 id="ethereum">Ethereum</h3>
<p>Ethereum est une devise virtuelle d&#xE9;velopp&#xE9;e sur une plateforme logicielle ouverte bas&#xE9;e sur la technologie blockchain qui permet aux d&#xE9;veloppeurs de cr&#xE9;er et d&#xE9;ployer des applications d&#xE9;centralis&#xE9;es qui ex&#xE9;cutent des contrats intelligents (<em><strong>&#xAB; smart contracts &#xBB;</strong></em>). C&#x2019;est fin 2013 que Vitalik Buterin, un chercheur et d&#xE9;veloppeur en crypto-monnaie, propose Ethereum.</p>
<p>&#xC0; l&#x2019;instar de Bitcoin, Ethereum est un r&#xE9;seau de blockchain publique. Bien qu&#x2019;il existe des diff&#xE9;rences techniques consid&#xE9;rables entre les deux, la distinction la plus importante est que Bitcoin et Ethereum diff&#xE8;rent consid&#xE9;rablement en termes d&#x2019;objectifs et de capacit&#xE9;s.Tandis que la blockchain bitcoin est utilis&#xE9;e pour suivre la propri&#xE9;t&#xE9; d&#x2019;une devise virtuelle (Bitcoins), la blockchain Ethereum se concentre sur l&#x2019;ex&#xE9;cution du code de programmation de toute application d&#xE9;centralis&#xE9;e.</p>
<p><strong>1 Ethereum = &#x20AC;300,78</strong></p>
<h2 id="la-blockchain-pour-les-nuls">La Blockchain pour les nuls</h2>
<p>Selon Wikip&#xE9;dia :</p>
<blockquote>
<p>Une blockchain, ou cha&#xEE;ne de blocs, est une technologie de stockage et de transmission d&apos;informations sans organe de contr&#xF4;le. Techniquement, il s&apos;agit d&apos;une base de donn&#xE9;es distribu&#xE9;e dont les informations envoy&#xE9;es par les utilisateurs et les liens internes &#xE0; la base sont v&#xE9;rifi&#xE9;s et group&#xE9;s &#xE0; intervalles de temps r&#xE9;guliers en blocs, l&apos;ensemble &#xE9;tant s&#xE9;curis&#xE9; par cryptographie, et formant ainsi une cha&#xEE;ne</p>
</blockquote>
<p>Une blockchain contient des donn&#xE9;es cr&#xE9;&#xE9;es par diff&#xE9;rents utilisateurs dans le temps et chaque acteur ou noeud de la blockchain poss&#xE8;de une copie de celle-ci.</p>
<p>Il existe diff&#xE9;rents types de blockchains : celles qui sont priv&#xE9;s, c&apos;est &#xE0; dire qu&apos;un nombre limit&#xE9; d&apos;acteurs, choisi arbitrairement, a le droit d&apos;agir sur la blockchain, et celles qui sont publiques et donc accessibles &#xE0; tout le monde sans aucune restriction. Comme l&apos;a dit le math&#xE9;maticien Jean-Paul Delahaye, une blockchain publique comme celle de Bitcoin peut &#xEA;tre assimil&#xE9;e &#xE0;</p>
<blockquote>
<p>un tr&#xE8;s grand cahier, que tout le monde peut lire librement et gratuitement, sur lequel tout le monde peut &#xE9;crire, mais qui est impossible &#xE0; effacer et indestructible.<em> </em></p>
</blockquote>
<p>Une image valant mieux qu&apos;un discours, voici comment on pourrait repr&#xE9;senter la technologie Blockchain de mani&#xE8;re simple :</p>
<p><img src="assets/fonctionnement-blockchain1.png" alt=""></p>
<p><img src="assets/blck-schema.png" alt=""></p>
<pre><code>                                   Source : Blockchain France
</code></pre><p>Les applications de la Blockchain sont multiples car elle permet d&apos;&#xE9;liminer les tiers de confiance habituels que sont les banques, les assurances, les notaires,...et m&#xEA;me l&apos;Etat.</p>
<p>Si l&apos;euro a de la valeur aujourd&apos;hui c&apos;est d&apos;abord parce que cette valeur nous la lui accordons et que les banques et les Etats europ&#xE9;ens veillent &#xE0; ce que cela soit toujours le cas en limitant sa quantit&#xE9; et sa provenance (BCE), en punissant p&#xE9;nalement la cr&#xE9;ation de fausses monnaies,...</p>
<p>Avec la blockchain, ces tiers de confiance peuvent s&apos;en aller en paix, la confiance &#xE9;tant r&#xE9;partie entre les diff&#xE9;rents acteurs du r&#xE9;seau blockchain. Rien ne nous emp&#xEA;che alors de cr&#xE9;er notre propre monnaie, la distribuer et de la valoriser aupr&#xE8;s d&apos;un large panel de d&#xE9;veloppeurs d&apos;applications mobiles enthousiastes. C&apos;est ce que nous allons faire tout au long des chapitres avec la cryptomonnaie <strong>DuckCoin</strong>.</p>
<h2 id="duckcoin--principes-de-fonctionnement">Duckcoin : principes de fonctionnement</h2>
<p>DuckCoin sera comme nous l&apos;avons d&#xE9;j&#xE0; dit une crypto-monnaie bas&#xE9;e sur une blockchain publique. L&apos;application mobile que nous allons d&#xE9;velopper tout au long de ce livre portera le m&#xEA;me nom.</p>
<p>De plus, la monnaie fonctionnera &#xE0; peu pr&#xE8;s sur le m&#xEA;me principe que le Bitcoin, en tout cas en ce qui concerne son architecture.</p>
<p>Ce livre n&apos;&#xE9;tant pas consacr&#xE9; &#xE0; la Blockchain et aux cryptomonnaies, vous n&apos;&#xEA;tes pas oblig&#xE9; de lire la suite de ce chapitre et pouvez directement passer &#xE0; la suite. Mais si vous &#xEA;tes un tant soit peu curieux, alors restez, vous ne serez pas dessus je pense.</p>
<h3 id="construction-de-la-blockchain">Construction de la Blockchain</h3>
<p>Pour d&#xE9;velopper la blockchain sur laquelle sera construite notre cryptomonnaie, nous allons utiliser le langage de programmation Python, qui est assez simple &#xE0; ma&#xEE;triser.</p>
<pre><code class="lang-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blockchain</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Constructeur : on initialise ici la cha&#xEE;ne et la liste qui contiendra les transactions</span>
        self.chain = []
        self.current_transactions = []

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_block</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Permet la cr&#xE9;ation d&apos;un nouveau block qui sera &#xE0; la chaine de blocs</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_transaction</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Ajoute une nouvelle transaction &#xE0; la liste des transactions.</span>
        <span class="hljs-comment"># Un bloc peut contenir plusieurs transactions, toutes les unes que les autres</span>
        <span class="hljs-keyword">pass</span>

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hash</span><span class="hljs-params">(block)</span>:</span>
        <span class="hljs-comment"># Permet le hashage d&apos;un Bloc</span>
        <span class="hljs-keyword">pass</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">last_block</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># Renvoie le dernier bloc de la chaine</span>
        <span class="hljs-keyword">pass</span>
</code></pre>
<p>La classe Blockchain sera responsable de la gestion de la cha&#xEE;ne. Elle va stocker les transactions et pourra gr&#xE2;ce &#xE0; des m&#xE9;thodes ajouter de nouvelles transactions ou de nouveaux blocs &#xE0; la cha&#xEE;ne.</p>
<p>Un Bloc poss&#xE8;de un <em><strong>index</strong></em>, c&apos;est &#xE0; dire un num&#xE9;ro qui permet de le situer dans la cha&#xEE;ne, un syst&#xE8;me d&apos;horodatage appel&#xE9; <em><strong>timestamp</strong></em><sup><a href="#fn_1" id="reffn_1">1</a></sup>, une <em><strong>liste</strong></em><strong> de transactions</strong>, une <strong>preuve de travail</strong> ou proof of work en anglais que nous abr&#xE9;gerons <em>pow</em>,  un <em><strong>hash</strong></em>, c&apos;est &#xE0; dire une empreinte num&#xE9;rique rendant le bloc unique en son genre, le <em><strong>hash</strong></em> du bloc pr&#xE9;c&#xE9;dant (<em>previous_hash</em>). Prenons par exemple le premier bloc de notre blockchain. Il ressemble &#xE0; ceci :</p>
<pre><code class="lang-py">block = {
    <span class="hljs-string">&apos;index&apos;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-string">&apos;timestamp&apos;</span>: <span class="hljs-number">1506057130.100625</span>,
    <span class="hljs-string">&apos;transactions&apos;</span>: [
        {
            <span class="hljs-string">&apos;sender&apos;</span>: <span class="hljs-string">&quot;2327147fe1f5426f9dd545de4b27ee00&quot;</span>,
            <span class="hljs-string">&apos;recipient&apos;</span>: <span class="hljs-string">&quot;82dec7f5cdfa2934df3954a5c7c7da5df1f&quot;</span>,
            <span class="hljs-string">&apos;amount&apos;</span>: <span class="hljs-number">30</span>,
        }
    ],
    <span class="hljs-string">&apos;proof&apos;</span>: <span class="hljs-number">952</span>,
    <span class="hljs-string">&apos;hash&apos;</span>: <span class="hljs-string">&quot;e24db68eb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824&quot;</span>,
    <span class="hljs-string">&apos;previous_hash&apos;</span>: <span class="hljs-string">&quot;&quot;</span>
}
</code></pre>
<p>Ici, le premier bloc ne poss&#xE8;de pas de hash pour le bloc pr&#xE9;c&#xE9;dent (<em>previous_hash</em>), ce qui est normal. Par contre, les blocs suivants devront l&apos;avoir obligatoirement. C&apos;est d&apos;ailleurs cela qui garantit en partie la fiabilit&#xE9; de la blockchain. En effet, si un seul bloc devait &#xEA;tre falsifi&#xE9; (un utilisateur qui mentirait sur le montant total de ses avoirs en modifiant un bloc), c&apos;est toute la cha&#xEE;ne qui deviendrait invalide.</p>
<p>A pr&#xE9;sent rentrons plus en d&#xE9;tail sur le fonctionnement des m&#xE9;thodes de la classe BlockChain.</p>
<h3 id="gestions-des-transactions">Gestions des transactions</h3>
<p>La m&#xE9;thode <strong>new_transaction</strong> est en charge de l&apos;ajout de nouvelles transactions au sein d&apos;un bloc.</p>
<pre><code class="lang-py"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blockchain</span><span class="hljs-params">(object)</span>:</span>
    ...

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_transaction</span><span class="hljs-params">(self, sender, recipient, amount)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;
        Cr&#xE9;ation d&apos;une nouvelle transaction qui sera int&#xE9;gr&#xE9; au dernier bloc &#xE0; inclure dans la blockchain
        :param sender: &lt;str&gt; Adresse (hash) du destinateur
        :param recipient: &lt;str&gt; Adresse (hash) du destinataire
        :param amount: &lt;int&gt; Montant envoy&#xE9; par le &apos;sender&apos; au &apos;recipient&apos;
        :return: &lt;int&gt; index du bloc qui stockera cette transaction
        &quot;&quot;&quot;</span>

        self.current_transactions.append({
            <span class="hljs-string">&apos;sender&apos;</span>: sender,
            <span class="hljs-string">&apos;recipient&apos;</span>: recipient,
            <span class="hljs-string">&apos;amount&apos;</span>: amount,
        })

        <span class="hljs-keyword">return</span> self.last_block[<span class="hljs-string">&apos;index&apos;</span>] + <span class="hljs-number">1</span>
</code></pre>
<p>Chaque fois qu&apos;un utilisateur souhaitera envoyer de l&apos;argent &#xE0; un autre, c&apos;est cette m&#xE9;thode qui sera appel&#xE9;e.  Le tout (la transaction) sera stock&#xE9;e dans le prochain bloc &#xE0; miner (notion que nous aborderons plus loin).</p>
<h3 id="gestion-des-blocs">Gestion des blocs</h3>
<p>A la cr&#xE9;ation de la blockchain, nous allons devoir cr&#xE9;er un bloc initial, qui stockera les toutes premi&#xE8;res transactions de la blockchain. C&apos;est &#xE0; l&apos;int&#xE9;rieur de ce bloc par exemple que l&apos;on pourra stocker les transactions permettant d&apos;envoyer de l&apos;argent aux 20 premiers utilisateurs de notre cryptomonnaie. Et oui, avoir de l&apos;argent en stock c&apos;est bien, mais si personne ne s&apos;en sert, elle n&apos;a aucune valeur.</p>
<p>Ce bloc initial est appel&#xE9; dans l&apos;univers des cryptomonnaies, le bloc <em><strong>Genesis</strong></em>, pour gen&#xE8;se en fran&#xE7;ais. Et avant la gen&#xE8;se, il n y a rien...en principe.</p>
<pre><code class="lang-py"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> hashlib sha256

<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blockchain</span><span class="hljs-params">(object)</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span>
        self.current_transactions = []
        self.chain = []

        <span class="hljs-comment"># Cr&#xE9;ation du bloc initial genesis</span>
        self.new_block(previous_hash=<span class="hljs-string">&apos;&apos;</span>, proof=<span class="hljs-number">100</span>)

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_block</span><span class="hljs-params">(self, proof, previous_hash=None)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;
        Cr&#xE9;ation d&apos;un nouveau bloc dans la Blockchain
        :param proof: &lt;int&gt; valeur retourn&#xE9; l&apos;algorithme de preuve de travail
        :param previous_hash: (Optionel pour le premier bloc) &lt;str&gt; Hash du bloc pr&#xE9;c.
        :return: &lt;dict&gt; Nouveau Bloc
        &quot;&quot;&quot;</span>

        block = {
            <span class="hljs-string">&apos;index&apos;</span>: len(self.chain) + <span class="hljs-number">1</span>,
            <span class="hljs-string">&apos;timestamp&apos;</span>: time(),
            <span class="hljs-string">&apos;transactions&apos;</span>: self.current_transactions,
            <span class="hljs-string">&apos;proof&apos;</span>: proof,
            <span class="hljs-string">&apos;previous_hash&apos;</span>: previous_hash <span class="hljs-keyword">or</span> self.hash(self.chain[<span class="hljs-number">-1</span>]),
        }

        <span class="hljs-comment"># Remise &#xE0; z&#xE9;ro de la liste des transactions</span>
        self.current_transactions = []

        self.chain.append(block)
        <span class="hljs-keyword">return</span> block

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">new_transaction</span><span class="hljs-params">(self, sender, recipient, amount)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;
        Cr&#xE9;ation d&apos;une nouvelle transaction qui sera int&#xE9;gr&#xE9; au dernier bloc &#xE0; inclure dans la blockchain
        :param sender: &lt;str&gt; Adresse (hash) du destinateur
        :param recipient: &lt;str&gt; Adresse (hash) du destinataire
        :param amount: &lt;int&gt; Montant envoy&#xE9; par le &apos;sender&apos; au &apos;recipient&apos;
        :return: &lt;int&gt; index du bloc qui stockera cette transaction
        &quot;&quot;&quot;</span>
        self.current_transactions.append({
            <span class="hljs-string">&apos;sender&apos;</span>: sender,
            <span class="hljs-string">&apos;recipient&apos;</span>: recipient,
            <span class="hljs-string">&apos;amount&apos;</span>: amount,
        })

        <span class="hljs-keyword">return</span> self.last_block[<span class="hljs-string">&apos;index&apos;</span>] + <span class="hljs-number">1</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">last_block</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-keyword">return</span> self.chain[<span class="hljs-number">-1</span>]

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hash</span><span class="hljs-params">(block)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;
        Cr&#xE9;ation d&apos;un hash du bloc avec la fonction de hashage SHA-256
        :param block: &lt;dict&gt; Block
        :return: &lt;str&gt;
        &quot;&quot;&quot;</span>

        <span class="hljs-comment"># On ordonne le bloc avant de le s&#xE9;rialiser</span>
        block_string = json.dumps(block, sort_keys=<span class="hljs-keyword">True</span>).encode()
        <span class="hljs-keyword">return</span> sha256(block_string).hexdigest()
</code></pre>
<h3 id="la-preuve-de-travail-proof-of-work-pow">La Preuve de travail, Proof of Work (pow)</h3>
<p>La preuve de travail est la m&#xE9;thode qui permet de cr&#xE9;er ou miner un nouveau bloc de la blockchain. Il s&apos;agit d&apos;un algorithm permettant, comme le rappel Wikip&#xE9;dia :</p>
<blockquote>
<p>de dissuader, sur un r&#xE9;seau informatique, des attaques par d&#xE9;ni de service et autres abus de service tels que le spam en requ&#xE9;rant de la puissance de calcul et de traitement par ordinateur au demandeur de service. C&apos;est un syst&#xE8;me difficile &#xE0; produire car il est co&#xFB;teux en temps et en &#xE9;nergie.</p>
</blockquote>
<p>Lorsqu&apos;un utilisateur effectue une transaction, celle-ci est, comme on l&apos;a vu, stock&#xE9;e dans un bloc. Une fois que le bloc poss&#xE8;de un certain nombre de transactions, il devra &#xEA;tre int&#xE9;gr&#xE9; &#xE0; la blockchain pour sauvegarde. C&apos;est &#xE0; ce moment l&#xE0; qu&apos;intervient le minage par preuve de travail. Chaque noeud (ordinateur) va recevoir le bloc souhaitant int&#xE9;grer la chaine et effectuer un certain nombre de calculs suffisament longs pour dissuader un noeud pirate. Et plus la chaine est longue comme celle de Bitcoin et d&apos;autres cryptomonnaies, et plus le calcul est &#xE9;negivore et d&#xE9;courageante pour le noeud pirate.</p>
<p>Le noeud ayant r&#xE9;ussi en premier &#xE0; r&#xE9;soudre l&apos;&#xE9;nigme se voit recompenser d&apos;une somme en crypto. Bitcoin recompense par exemple ses mineurs &#xE0; hauteur de 25 BTC (&#xE0; l&apos;heure actuelle).</p>
<p>Une caract&#xE9;ristique de la pow est l&apos;asym&#xE9;trie du co&#xFB;t de calcul : le travail doit &#xEA;tre difficilement r&#xE9;alisable pour le demandeur, mais facilement v&#xE9;rifiable pour un tiers.</p>
<p>Prenons par exemple une preuve de travail bien connu, le Captcha, que l&apos;on retrouve sur de nombreux sites internet.</p>
<p><img src="assets/reCAPTCHA_Sample_White.png" alt=""></p>
<p>Si pour un humain, saisir ces informations est d&#xE9;j&#xE0; assez difficile, imaginez ce qu&apos;&#xE9;prouvera un robot spammeur.</p>
<hr>
<p>Pour en savoir plus, n&apos;h&#xE9;sitez pas &#xE0; lire le bel article de <strong>Cryptoencyclopedie</strong> : <a href="https://www.cryptoencyclopedie.com/single-post/Quest-ce-que-le-consensus-Proof-of-Work-" target="_blank">https://www.cryptoencyclopedie.com/single-post/Quest-ce-que-le-consensus-Proof-of-Work- </a></p>
<hr>
<p>Pour notre algorithme de preuve de travail, choisissons arbitrairement que le hash d&apos;un entier X, multipli&#xE9; par un autre entier Y devra absolument se commencer par 3 chiffres 0. On aurait ceci par exemple :</p>
<pre><code class="lang-py">hash(x * y) = <span class="hljs-number">000</span>ecad23dc...
</code></pre>
<p>Cela donnerait le code suivant :</p>
<pre><code class="lang-py"><span class="hljs-keyword">import</span> json

<span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256
<span class="hljs-keyword">from</span> time <span class="hljs-keyword">import</span> time
<span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> uuid4


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Blockchain</span><span class="hljs-params">(object)</span>:</span>
    ...

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">proof_of_work</span><span class="hljs-params">(self, last_proof)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;
        Un algorithme de Preuve de travail :
         - Trouver un nombre x tel que hash(xy) commence par 3 zeros
         - x &#xE9;tant la preuve pr&#xE9;cendente (last_proof)
         - y &#xE9;tant une valeur que l&apos;on incr&#xE9;mentera en partant de zero et qui
         &#xE0; la fin du calcul deviendra la nouvelle preuve (proof)
        :param last_proof: &lt;int&gt;
        :return: &lt;int&gt;
        &quot;&quot;&quot;</span>
        proof = <span class="hljs-number">0</span>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.valid_proof(last_proof, proof):
            proof += <span class="hljs-number">1</span>

        <span class="hljs-keyword">return</span> proof

<span class="hljs-meta">    @staticmethod</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">valid_proof</span><span class="hljs-params">(last_proof, proof)</span>:</span>
        <span class="hljs-string">&quot;&quot;&quot;
        Validation du r&#xE9;sulat de la preuve de travail : est-ce que hash(last_proof, proof)
        commence bien par 3 zeros ?
        :param last_proof: &lt;int&gt; Preuve pr&#xE9;c&#xE9;dente
        :param proof: &lt;int&gt; Preuve actuelle
        :return: &lt;bool&gt;
        &quot;&quot;&quot;</span>
        proof_hash = sha256(str(last_proof*proof)).hexdigest()
        <span class="hljs-keyword">return</span> proof_hash[:<span class="hljs-number">3</span>] == <span class="hljs-string">&quot;000&quot;</span>
</code></pre>
<p>On aurait pu compliquer le calcul en testant un nombre de z&#xE9;ros beaucoup plus grand, mais l&apos;on se contentera de 3 z&#xE9;ros. Si vous passer de 3 &#xE0; 4, le m&#xEA;me calcul avec les m&#xEA;mes valeurs en entr&#xE9;e est largement plus long. Donc on imagine bien que plus l&apos;on augmente le nombre de z&#xE9;ros, et plus les choses se compliquent.</p>
<p>Un test avec une valeur de x=2018, permet d&apos;avoir un r&#xE9;sultat en 0.07s environ</p>
<pre><code class="lang-py"><span class="hljs-keyword">import</span> time

x = <span class="hljs-number">2018</span> <span class="hljs-comment"># Derni&#xE8;re preuve</span>
y = <span class="hljs-number">0</span>  <span class="hljs-comment"># Valeur que l&apos;on incr&#xE9;mentera jusqu&apos;&#xE0; trouver le bon r&#xE9;sultat</span>

debut = time.time()
<span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> valid_proof(x,y):
    y += <span class="hljs-number">1</span>
    <span class="hljs-keyword">print</span> y

fin = time.time()
duree = fin-debut

<span class="hljs-comment"># Hash trouv&#xE9; : 000e7ea9705df1fe65fe077d5054fe4a12aa6bbe074d5060ed9f0b251e16d0f9</span>
<span class="hljs-comment"># La solution est y = 566 au bout de 0.0716059207916 s</span>
</code></pre>
<p>Le meme test prend plus de 6s pour un nombre de z&#xE9;ros &#xE9;gal &#xE0; 4.</p>
<p>Pour rappel, la preuve de travail du Bitcoin, qui ressemble &#xE0; peu pr&#xE8;s &#xE0; celle que l&apos;on a implement&#xE9;, utilise un nombre de z&#xE9;ros &#xE9;gal &#xE0; 18 (voir image ci-dessous). C&apos;est quand m&#xEA;me &#xE9;norme !</p>
<p><img src="assets/block_screen.png" alt=""></p>
<h3 id="interaction-avec-la-blockchain-duckcoin">Interaction avec la Blockchain DuckCoin</h3>
<p>Pour l&apos;affichage et les interactions avec la blockchain, nous utiliserons un framework Python nomm&#xE9; Flask, robuste et tr&#xE8;s simple &#xE0; prendre en main. Si vous souhaitez en savoir plus sur Flask, n&apos;h&#xE9;sitez pas &#xE0; lire l&apos;excellente documentation en ligne : <a href="http://flask.pocoo.org/" target="_blank">http://flask.pocoo.org/</a></p>
<p>Notre cryptomonnaie qui est disponible &#xE0; l&apos;adresse : <a href="https://duckcoin.charlesen.fr/" target="_blank">https://duckcoin.charlesen.fr/</a> peut &#xEA;tre exploit&#xE9;e via les actions suivantes :</p>
<table>
<thead>
<tr>
<th style="text-align:left">Action</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">/transactions/new</td>
<td style="text-align:left">Permet d&apos;ajouter une nouvelle transaction</td>
</tr>
<tr>
<td style="text-align:left">/mine</td>
<td style="text-align:left">Minage d&apos;un nouveau bloc</td>
</tr>
<tr>
<td style="text-align:left">/chain</td>
<td style="text-align:left">Retourne la blockchain compl&#xE8;te</td>
</tr>
</tbody>
</table>
<p>Maintenant que notre outil est en place, nous pouvons seirenement nous lancer dans la cr&#xE9;ation de l&apos;application mobile qui nous permettra d&apos;interagir avec la Blockchain, g&#xE9;rer notre portefeuille, envoyer ou recevoir de l&apos;argent sous forme de tokens <strong>DCK</strong>.</p>
<blockquote id="fn_1">
<sup>1</sup>. Le timestamp (unix) d&#xE9;signe le nombre de secondes &#xE9;coul&#xE9;es depuis le 1er janvier 1970 &#xE0; minuit UTC pr&#xE9;cise<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#x21A9;</a>
</blockquote>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="chapter1.html" class="navigation navigation-prev " aria-label="Previous page: Chap 1 - Une brêve histoire du mobile">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="chap-3-installation-de-ionic-et-premieres-prises-en-main.html" class="navigation navigation-next " aria-label="Next page: Chap 3 - Installation de Ionic et première prise en main">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Chap 2 - Cas pratique : DuckCoin, la cryptomonnaie sur mobile","level":"1.7","depth":1,"next":{"title":"Chap 3 - Installation de Ionic et première prise en main","level":"1.8","depth":1,"path":"chap-3-installation-de-ionic-et-premieres-prises-en-main.md","ref":"chap-3-installation-de-ionic-et-premieres-prises-en-main.md","articles":[]},"previous":{"title":"Chap 1 - Une brêve histoire du mobile","level":"1.6","depth":1,"path":"chapter1.md","ref":"chapter1.md","articles":[]},"dir":"ltr"},"config":{"plugins":["disqus","-lunr","-search"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"ionic-edounze-com"},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"links":{"sidebar":{}},"gitbook":"*"},"file":{"path":"chap-2.md","mtime":"2018-04-19T10:20:27.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-04-20T07:03:07.723Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

